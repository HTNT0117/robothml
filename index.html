<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pepper Recommender</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  <script src="js/jquery-1.11.0.min.js"></script>
  <script>
    function subscribe_PepperQiMessaging() { console.log('üîß [MOCK] subscribe'); }
    window.session = {
      service: () => ({ done: cb => cb({ raiseEvent:(e,d)=>console.log(`üîß [MOCK] ${e}`, d) }) })
    };
  </script>
  <style>
    html, body { margin:0; padding:0; overflow:hidden; width:100%; height:100%; }
    #container { width:100vw; height:100vh; position:relative; }
    iframe {
      display:none;
      position:fixed; top:0; left:0;
      width:100vw; height:100vh;
      border:none; margin:0; padding:0;
      z-index:999;
    }
  </style>
</head>
<body onload="subscribe_PepperQiMessaging();">
  <div id="container">
    <div style="position:absolute; top:10px; right:10px; cursor:pointer;"
         onclick="stopChitchat()">
      <i class="fa-solid fa-circle-question" style="color:#0081AF;"></i>
    </div>
    <div style="text-align:center; margin-top:20vh; margin-bottom:15%;">
      <h1 id="display" class="headline">
        Xin ch√†o, b·∫°n c√≥ mu·ªën tr√≤ chuy·ªán m·ªôt l√∫c kh√¥ng?
      </h1>
    </div>
    <div class="flex-area"
         style="position:absolute; bottom:10%; left:50%; transform:translateX(-50%);
                display:flex; gap:20px;">
      <button id="startChitBtn" class="custom-yes-btn bubble-bottom-right">
        Start Chitchat
      </button>
    </div>
  </div>

  <iframe src="chitchat.html" id="chitchatScreen"></iframe>
  <iframe src="message.html"    id="messageScreen"></iframe>

  <script src="https://kit.fontawesome.com/54a1468923.js" crossorigin="anonymous"></script>
  <script>
    const main = document.getElementById('container');
    const chit = document.getElementById('chitchatScreen');
    const msg  = document.getElementById('messageScreen');
    let cycleCount = 0;  // ƒë·∫øm s·ªë l·∫ßn ƒë√£ show message

    function startChitchat() {
      main.style.display = 'none';
      chit.style.display = 'block';

      setTimeout(() => {
        chit.style.display = 'none';
        msg.style.display  = 'block';
        // b·∫£o message.html b·∫Øt ƒë·∫ßu show message[msgIndex]
        msg.contentWindow.postMessage({ type: 'start-message' }, '*');
      }, 10000);
    }

    document.getElementById('startChitBtn').addEventListener('click', startChitchat);

    // t·ª± ƒë·ªông 3s sau load
    window.addEventListener('DOMContentLoaded', () => {
      setTimeout(startChitchat, 3000);
    });

    function stopChitchat() {
      msg.style.display  = 'none';
      chit.style.display = 'none';
      main.style.display = 'block';
      cycleCount = 0;
    }

    window.addEventListener('message', e => {
      if (e.data && e.data.type === 'next-screen') {
        cycleCount++;
        // quay l·∫°i chitchat
        msg.style.display  = 'none';
        chit.style.display = 'block';

        if (cycleCount < 2) {
          // ti·∫øp t·ª•c chu k·ª≥ cho l·∫ßn th·ª© 2
          setTimeout(() => {
            chit.style.display = 'none';
            msg.style.display  = 'block';
            msg.contentWindow.postMessage({ type: 'start-message' }, '*');
          }, 10000);
        }
      }
    });
  </script>
</body>
</html>
